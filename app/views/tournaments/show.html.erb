<h1>Tournament Details</h1>

<hr>

<p id="notice"><%= notice %></p>

<h2>Tournament details</h2>

<div class="row">
  <div class="span6">
    <table class="table">
      <thead>
      </thead>
      <tbody>
        <tr>
          <td><b>Name</b></td>
          <td><%= @tournament.name %></td>
        </tr>
        <tr>
          <td><b>Date started</b></td>
          <td><%= @tournament.date_started %></td>
        </tr>
        <tr>
          <td><b>Date finished</b></td>
          <td><%= @tournament.date_finished %></td>
        </tr>
        <tr>
          <td><b>Status</b></td>
          <td><%= @tournament.status %></td>
        </tr>
        <tr>
          <td><b>Admin</b></td>
          <td><%= @tournament.admin_id %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<h2>Rounds</h2>

<div class="row">
  <div id="span12">
    <table class="table">
      <tr>
        <th>Id</th>
        <th>Tournament Round Id</th>
        <th></th>
        <% if can? :manage, @tournament %>
          <th></th>
          <th></th>
        <% end %>
      </tr>

      <% @tournament.rounds.each do |round| %>
        <tr>
          <td><%= round.id %></td>
          <td><%= round.tournament_round_id %></td>
          <td><%= link_to 'Show', tournament_round_path(@tournament, round) %></td>
          <% if can? :manage, @tournament %>
            <td><%= link_to 'Edit', edit_tournament_round_path(@tournament, round) %></td>
            <td><%= link_to 'Destroy', [@tournament, round], confirm: 'Are you sure?', method: :delete %></td>
          <% end %>
        </tr>
      <% end %>
    </table>
  </div>
</div>

<h2>Players (and maybe live rankings, later)</h2>

<div class="row">
  <div id="span12">
    <table class="table">
      <tr>
        <th>Player name</th>
        <th>Player email</th>
      </tr>

      <% @tournament.players.each do |p| %>
        <tr>
          <td><%= p.name %></td>
          <td><%= p.email %></td>
        </tr>
      <% end %>
    </table>
  </div>
</div>

<% if @tournament.players.include?(current_player) %>
  <!-- this is one of the ugliest things I've ever seen, seconded perhaps only by your momma.. -->
  <%= link_to participation_path(TournamentPlayer.find(current_player.tournament_players(:tournament_id => @tournament.id).first.id)),
    confirm: 'Are you sure?', method: :delete, :class => "btn btn-warning" do %>
    <i class="icon-white icon-remove-sign"></i>
    Withdraw this tournament
  <% end %>
<% else %>
  <%= form_for TournamentPlayer.new, :url => participations_path do |f| %>
    <%= f.hidden_field :tournament_id, :value => @tournament.id %>
    <%= f.hidden_field :player_id, :value => current_player.id %>
    <button type="submit" class="btn btn-success">
      <i class="icon-white icon-ok-sign"></i>
      Sign up for this tournament
    </button>
  <% end %>
<% end %>


<div class="form-actions">
  <% if can? :manage, @tournament %>
    <%= link_to 'Create new round', new_tournament_round_path(@tournament), :class => "btn btn-primary" %>
    <%= link_to 'Edit', edit_tournament_path(@tournament), :class => "btn" %>
  <% end %>
  <%= link_to 'Back', tournaments_path, :class => "btn" %>
</div>
